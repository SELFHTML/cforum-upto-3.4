<?xml version="1.0" encoding="ISO-8859-1" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-loose.dtd">

<html>
<head>
<title>SELFHTML Forum: Doku: Konfiguration: Das src-Verzeichnis</title>

<meta name="description"    content="Die Doku des neuen SELFHTML Forums" />
<meta name="keywords"       content="SELFHTML Forum, Doku, Dokumentation" />
<meta name="author"         content="Christian Kruse, ckruse@wwwtech.de" />
<meta name="DC.Publisher"   content="Christian Kruse, ckruse@wwwtech.de" />
<meta name="DC.Date"        content="2002-04-08T16:46+02:00" />
<meta name="DC.Identifier"  content="---" />
<meta name="DC.Language"    content="de" />
<meta name="DC.Rights"      content="" />
<meta name="SELF.Firstdate" content="2002-04-08T16:46+02:00" />
<meta name="SELF.Version"   content="0.01" />
<meta name="SELF.Pagetype"  content="Information" />

<link rel="shortcut icon" href="../../src/favicon.ico" />
<link rel="stylesheet" type="text/css" href="../../src/forum.css" />
</head>

<body>
<table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr><td bgcolor="#FFEEDD" class="nav"><a class="an" name="top"><img src="../../src/x2.gif" width="16" height="13" border="0" alt="Teil von" /></a> <a href="../../../"><b>SELFHTML Developer</b></a> <img src="../../src/x2.gif" width="16" height="13" border="0" alt="Teil von" /> <a href="../../"><b>SELFHTML Forum</b></a> <img src="../../src/x2.gif" width="16" height="13" border="0" alt="Teil von" /> <a href="../"><b>SELFHTML Forum Doku</b></a></td></tr>
</table>
<table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr><td bgcolor="#EEEEEE" class="doc" width="110"><img src="../../src/xweb.gif" width="106" height="109" border="0" alt="SELFHTML" /></td>
<td bgcolor="#EEEEEE" class="doc" valign="bottom" width="100%"><h2>SELFHTML Forum<br />Dokumentation: Der Konfigurations-Parser</h2></td></tr>
<tr><td bgcolor="#EEEEEE" class="doc" valign="top" align="center"><img src="../../src/x5.gif" width="30" height="20" vspace="6" border="0" alt="Informationsseite" /></td>
<td bgcolor="#FFFFFF" valign="top">
<p><img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a1"><b>Der Konfigurations-Parser</b></a><br />
<img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a2"><b>default_options</b></a><br />
<img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a3"><b>fo_view_options</b></a><br />
<img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a4"><b>fo_user_options</b></a><br />
<img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a5"><b>get_conf_file</b></a><br />
<img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a6"><b>read_config</b></a><br />
<img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a7"><b>handle_command</b></a><br />
<img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a8"><b>cfg_cleanup</b></a><br />
<img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="weiter unten" />&nbsp;<a href="#a9"><b>cfg_get_value</b></a><br />
</p>
<tr><td colspan="2" bgcolor="#EEEEEE" class="doc"><a href="#bottom"><img src="../../src/xgdown.gif" width="14" height="10" border="0" alt="nach unten" /></a>&nbsp;</td></tr>
</table>

<h2 class="Sh2"><a class="an" name="a1">Der Konfigurations-Parser</a></h2>
<p>
 Der Konfigurations-Parser arbeitet recht einfach: er bekommt eine Liste von Direktiven (<tt>t_conf_opt</tt>) und
 ruft eine definierte Callback-Datei auf. Diese Callback-Datei baut eine Struktur auf, auf die man mit der Funktion
 <tt>cfg_get_value</tt> zugreifen kann. Die Struktur ist unterteilt in <b>Sektionen</b> und <b>Direktiven</b>.
 Der Typ <tt>t_conf_opt</tt> besteht aus einem Struct <tt>s_conf_opt</tt>. Der hat folgende Felder:
</p>
<ul>
  <li>const char *name</li>
  <li>short int type</li>
  <li>t_callback_function callback</li>
  <li>void *data</li>
</ul>

<p>
 <tt>name</tt> bezeichnet den Namen der Direktive (Achtung! Case-Sensitiv!). <tt>type</tt> ist der Datentyp der
 Direktive, g&uuml;ltig sind hier <tt>ARG_STR</tt> f&uuml;r String-Werte, <tt>ARG_INT</tt> f&uuml;r Integer-Werte,
 <tt>ARG_LONG</tt> f&uuml;r long-Werte, <tt>ARG_NONE</tt> f&uuml;r Direktiven ohne Parameter (z. B.
 <tt>&lt;Section&gt;...&lt;/Section&gt;</tt>), <tt>ARG_YESNO</tt> f&uuml;r Direktiven, die nur &quot;yes&quot; oder
 &quot;no&quot; erwarten und <tt>ARG_IGNORE</tt> f&uuml;r Direktiven, die einfach &uuml;bergangen werden sollen.
</p>
<p>
 <tt>t_callback_function</tt> ist eine Funktion, die einen Integer-Wert zur&uuml;ck gibt (0 bei Erfolg, ungleich 0 bei
 Fehler) und einen <tt>t_conf_entry</tt> und einen <tt>void *</tt>-Pointer erwartet. Der <tt>void *</tt>-Pointer ist
 ein Pointer zu den Daten, die der User der Callback-Funktion &uuml;bergeben will. <tt>t_conf_entry</tt> ist ein
 Struct mit den folgenden Eintr&auml;gen:
</p>

<ul>
 <li>int line_number</li>
 <li>int type</li>
 <li>const char *name</li>
 <li>union value
   <ul>
     <li>int  ivalue</li>
     <li>long lvalue</li>
     <li>const char *cvalue</li>
   </ul>
 </li>
</ul>

<p>
 <tt>type</tt> hat dieselben Werte wie oben definiert.
</p>

<p>
  Mit dem <tt>void *data</tt> kann man Daten definieren, die man der Callback-Funktion &uuml;bergeben will.
</p>


<h2 class="Sh2"><a class="an" name="a2">t_conf_opt default_options[]</a></h2>
<p>
 In dieser Variablen werden die Default-Optionen gespeichert. Default-Optionen sollen Direktiven sein, die in mehreren
 Dateien gebraucht werden, beispielsweise der <tt>SocketPath</tt>.
</p>

<h2 class="Sh2"><a class="an" name="a3">t_conf_opt fo_view_options[]</a></h2>
<p>
 Hier werden die Direktiven f&uuml;r das Viewer-Programm gespeichert.
</p>

<h2 class="Sh2"><a class="an" name="a4">t_conf_opt fo_user_options[]</a></h2>
<p>
 Hier werden die Direktiven f&uuml;r die User-Optionen gespeichert.
</p>

<h2 class="Sh2"><a class="an" name="a5">char **get_conf_file(char **argv)</a></h2>
<p>
 Diese Funktion sucht den Kompletten Pfad zu den Konfigurations-Dateien, packt sie in einen char *-Array und gibt
 diesen zur&uuml;ck. <b>Wichtig</b>: hier wird Speicher alloziiert! Beispiel:
</p>
<table width="100%" cellpadding="10"><tr><td class="xmpcode" bgcolor="#FFFFE0"><pre>
char **files = get_config_files(argv);
if(files) {
  if(files[0]) {
    free(files[0]);
  }
  if(files[1]) {
    free(files[1]);
  }
  free(files);
}
</pre></table>

<h2 class="Sh2"><a class="an" name="a6">int read_config(const char *name,t_conf_opt *options)</a></h2>
<p>
 Diese Funktion liest eine Konfigurations-Datei ein und parsed sie. F&uuml;r jede Direktive, die in
 <tt>t_conf_opt *options</tt> definiert ist, ruft sie die entsprechende Callback-Funktion auf, sobald
 sie in der Konfigurations-Datei auftritt.
</p>

<h2 class="Sh2"><a class="an" name="a7">int handle_command(t_conf_entry *entry,void *arg)</a></h2>
<p>
 Diese Funktion nimmt eine Direktive entgegen und f&uuml;gt sie in die Struktur ein.
</p>

<h2 class="Sh2"><a class="an" name="a8">void cfg_cleanup(t_configuration *cfg)</a></h2>
<p>
  Diese Funktion r&auml;umt eine Konfigurations-Struktur wieder auf.
</p>

<h2 class="Sh2"><a class="an" name="a9">t_name_value *cfg_get_value(t_configuration *cfg,const char *section,const char *name)</a></h2>
<p>
  Diese Funktion schaut nach, ob die &uuml;bergebene Direktive in der &Uuml;bergebenen Sektion der &uuml;bergebenen
  Konfigurations-Struktur vorhanden ist. Wurde sie gefunden, wird sie zur&uuml;ck gegeben, ansonsten wird NULL
  zur&uuml;ck gegeben.
</p>

<table cellpadding="4" cellspacing="0" border="0" width="100%">
<tr><td bgcolor="#EEEEEE" class="doc"><a href="#top"><img src="../../src/xgoup.gif" width="14" height="10" border="0" alt="nach oben" /></a></td></tr>
<tr><td bgcolor="#FFEEDD" class="nav"><a class="an"><img src="../../src/x2.gif" width="16" height="13" border="0" alt="Teil von" /></a> <a href="../../../"><b>SELFHTML Developer</b></a> <img src="../../src/x2.gif" width="16" height="13" border="0" alt="Teil von" /> <a href="../../"><b>SELFHTML Forum</b></a> <img src="../../src/x2.gif" width="16" height="13" border="0" alt="Teil von" /> <a href="../"><b>SELFHTML Forum Doku</b></a></td></tr>
</table>

<p><a class="an" name="bottom">&copy; 2000/2001</a> <img src="../../src/xgmail.gif" width="15" height="10" border="0" alt="E-Mail" />&nbsp;<a href="mailto:selfhtml@teamone.de">selfhtml@teamone.de</a> / version 1.0 by <img src="../../src/xgmail.gif" width="15" height="10" border="0" alt="E-Mail" />&nbsp;<a href="mailto:ckruse@wwwtech.de">Christian Kruse</a></p>
</body>
</html>

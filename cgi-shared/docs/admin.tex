\documentclass[a4paper,11pt]{article}

\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage{german}
\usepackage[dvips,pdftex]{graphicx}
\usepackage{ae,aecompl}

\begin{document}

\tableofcontents

\section{Einleitung}
Die Administration des Classic Forums gestaltet sich nach anfänglicher Konfiguration als recht
einfach, da es weitestgehend autonom arbeitet. In dieser Dokumentation sollen die
Konfigurations-Variablen durchgesprochen werden. Ausserdem wird auf einige Besonderheiten aufmerksam
gemacht, die notwendig sind, um das Forum zu verwalten.

Ich habe alle Konfigurations-Optionen beschrieben. Optionen, die nicht in der Beschreibung hier
auftauchen, sind bisher wirkunglos und noch nicht implementiert.

\section{Installations-Anleitung}

\subsection{System-Vorraussetzungen}

\begin{itemize}
\item Linux oder ein anderes Unix
\item Ca. 15MB freier RAM, abhängig von der maximalen Größe der Hauptdatei
\item Genügend freier Festplattenspeicher für die Forums-Daten
\item Die GDOME-Bibliothek (erhältlich unter http://gdome2.cs.unibo.it/)
\item Die \texttt{iconv}-Bibliothek, unter Linux in der Regel schon installiert, bei FreeBSD muss sie nachinstalliert werden
\item Die \texttt{libwwww} (erhältlich unter http://www.w3.org/Library/)
\item Die \texttt{libpcre} (erhältlich unter http://www.pcre.org/)
\item POSIX Threads-Unterstützung (bei Linux seit Kernel 2.4 implementiert)
\item Die BerkeleyDB, mindestens Version 3 (erhältlich unter http://www.sleepycat.com/products/db.shtml)
\item Die \texttt{libidn} (erhältlich unter http://www.gnu.org/software/libidn/)
\item Perl in Version 5.6 oder höher
\end{itemize}

\subsection{Übersetzen des Foren-Sourcecode}
Zuerst sollten Sie sich den Sourcecode des Forums besorgen, den Sie auf http://wwwtech.de/ finden.
Das letzte Stable-Release ist dort immer verlinkt. Wenn Sie den Sourcecode heruntergeladen haben,
können Sie ihn mit diesem Befehl entpacken: \texttt{tar -xzf cforum-*.tgz}. Dann wechseln Sie in
das richtige Verzeichnis: \texttt{cd cforum-*}. Nun müssen Sie das \texttt{configure}-Script laufen
lassen. Dieses Script kennt verschiedene Parameter. Die wichtigsten werden hier aufgezählt und
erklärt:

\begin{description}
\item[--bindir]{
  Mit dieser Option wird das Verzeichnis angegeben, in welches die Foren-Programme installiert werden sollen. Hier
  sollten Sie optimalerweise ein \texttt{cgi-bin}-Verzeichnis angeben.
}
\item[--libdir]{
  Mit dieser Option geben Sie an, in welches Verzeichnis die Bibliotheken, Plugins und Templates des Classic Forum
  installiert werden sollen.
}
\item[--enable-shared-mem]{
  Mit dieser Option werden die Shared Memory-Funktionen des Classic Forum aktiviert. Näheres dazu im Abschnitt
  \textbf{Shared Memory}, Seite \pageref{shm}.
}
\item[--with-message-dir]{Mit dieser Option wird angegeben, in welchem Verzeichnis die Nachrichten-Dateien liegen sollen.}
\item[--with-data-dir]{Mit dieser Option wird angegeben, in welchem Verzeichnis diverse Daten-Dateien des Forums liegen sollen.}
\item[--with-document-root]{Mit dieser Option wird angegeben, welches Verzeichnis das Basis-Verzeichnis der Foren-Installation sein soll.}
\item[--with-archive-dir]{Mit dieser Option wird das Verzeichnis angegeben, in welchem archivierte Threads gespeichert werden sollen.}
\item[--with-config-dir]{Mit dieser Option wird das Verzeichnis angegeben, in das die Konfigurations-Dateien des Forums installiert werden sollen.}
\item[--with-perl-mods]{Mit dieser Option wird das Installations-Verzeichnis für die benötigten Perl-Module angegeben.}
\item[--with-socket-path]{Mit dieser Option wird angegeben, welchen Namen der Kommunikations-Socket tragen soll, z. B. \texttt{/tmp/cforum}.}
\item[--with-log-dir]{Mit dieser Option wird angegeben, wo die Log-Dateien des Classic Forum liegen sollen.}
\item[--with-proto-file]{Mit dieser Option wird eine Protokoll-Datei angegeben, die protokolliert, wann welches Foren-Programm warum abgestürzt ist.}
\end{description}

Sie sollten für jede dieser Optionen einen Wert angeben. Ein Beispiel eines Aufrufs des \texttt{configure}-Scripts:

\begin{verbatim}
CFLAGS='-O3 -fexpensive-optimizations -fomit-frame-pointer -pipe' \
./configure \
  --libdir=/home/ckruse/www/cforum/cgi-shared/lib/ \
  --bindir=/home/ckruse/www/cforum/cgi-bin/ \
  --with-message-dir=/home/ckruse/www/cforum/cgi-shared/data/messages/ \
  --with-archive-dir=/home/ckruse/www/cforum/cgi-shared/data/archive/ \
  --with-config-dir=/home/ckruse/www/cforum/cgi-shared/config/ \
  --with-perl-mods=/home/ckruse/www/cforum/cgi-shared/lib/ \
  --with-log-dir=/home/ckruse/www/cforum/cgi-shared/logs/ \
  --with-proto-file=/home/ckruse/www/cforum/cgi-shared/logs/proto.txt \
  --with-data-dir=/home/ckruse/www/cforum/cgi-shared/data/ \
  --enable-shared-mem
\end{verbatim}

Nun können Sie den Kompilations-Prozess mit dem Befehl \texttt{make} in Gang setzen. \texttt{make install} installiert
nun die Dateien an den richtigen Platz. Jetzt müssen nur noch einige Perl-Module installiert werden, damit der
Installations-Prozess abgeschlossen ist. Dazu wechseln Sie in das Verzeichnis \texttt{src/perl/CForum-Clientlib}. Hier
geben Sie den Befehl \texttt{perl Makefile.PL LIB=/home/ckruse/www/cforum/cgi-shared/lib/} ein. Ersetzen Sie den Pfad
hinter \texttt{LIB=} durch den auf ihrem System entsprechenden Pfad. Nun geben Sie \texttt{make \&\& make install} ein.
Diesen Prozess wiederholen Sie für die Module in \texttt{src/perl/CForum-Template}, \texttt{src/perl/CForum-Validator}
und \texttt{src/perl/CForum-Configparser}.

Die Installation ist nun abgeschlossen. Weiter geht es mit der \textbf{Konfiguration des Classic Forums}, Seite \pageref{config}.

\section{Konfiguration des Classic Forums}
\label{config}

Das Classic Forum wird über eine Environment-Variable und mehrere Konfigurations-Variablen konfiguriert. Die
Environment-Variable, die benötigt wird, heisst \texttt{CF\_CONF\_DIR}. Ihr Inhalt beschreibt, wo die Konfigurationsdateien
gelagert werden. Es wird im Webserver also ein Modul benötigt, dass Environment-Variablen setzen kann, bei Apache ist das
\texttt{mod\_env} und ist standardmäßig installiert. Erstellen Sie also im \texttt{cgi-bin}-Verzeichns, das Sie vorher dem
\texttt{configure}-Script mit \texttt{--bindir} mitgegeben haben, eine \texttt{.htaccess}-Datei mit etwa folgendem Inhalt:

\begin{verbatim}
SetEnv CF_CONF_DIR "/home/ckruse/www/cforum/cgi-shared/config/"

<Files ~ "fo_(cleanup|server|tid_index)">
  Order Allow,Deny
  Deny from all
</Files>
\end{verbatim}

Setzen Sie statt \texttt{/home/ckruse/www/cforum/cgi-shared/config/} Ihr eigenes Konfigurationsverzeichnis ein. In dem
\texttt{cgi-bin}-Verzeichnis wurde automatisch ein Unterverzeichnis \texttt{user} angelegt. Hier legen Sie eine weitere
\texttt{.htaccess}-Datei an, in dem Sie die Authentifizierungsmethode definieren. Bei einer Authentifizierung über MySQL
sähe das z. B. so aus:

\begin{verbatim}
AuthName "Classic Forum User View"
AuthType Basic

AuthMySQLCryptedPasswords off
AuthMySQLMD5Passwords off

AuthMySQLUser datenbankuser
AuthMySQLPassword datenbankpasswort
AuthMySQLDB cforum_auth
AuthMySQLUserTable users
AuthMySQLNameField uname
AuthMySQLPasswordField password
\end{verbatim}

Das Classic Forum unterstützt SQL-Datenbanken als Userbackend von Haus aus, so dass sich eine SQL-Datenbank zur Authentifizierung
anbieten würde.

\fbox{\parbox{10cm}{\textbf{Vorsicht!} Einige Authentifizierungsmodule haben einen Fehler, so dass es bei Verwendung von
Keep-Alive-Verbindungen zu Problemen führen kann. Das äussert sich, dass z. B. sämtliche Browser der Gecko-Engine
Probleme mit dem CSS haben oder die HTTP-Header anzeigen. Sollten diese Probleme auftreten, können Sie das Problem umgehen
indem Sie folgende Direktive mit aufnehmen: \texttt{BrowserMatch .? nokeepalive}. Diese Direktive sorgt dafür, dass Keep-Alive
für \textbf{alle} Requests abgeschaltet wird. Das kann allerdings auch zu einem Performance-Problem führen!}}

Jetzt fehlt eigentlich nur noch die Konfiguration des Forums selber. Dazu ist es ratsam (in der Regel allerdings nicht zwingend
notwendig) sich jede einzelne Konfigurationsdatei anzusehen und jede Option auf Ihre Richtigkeit zu überprüfen. In den folgenden
Kapiteln werden die meisten Konfigurationsdirektiven vorgestellt. Jedoch sollten Sie eigentlich auch selbsterklärend sein. Wie
auch immer, sind alle Konfigurationsdateien geprüft, können Sie den Forenserver mit folgendem Befehl starten:

\begin{verbatim}
export CF_CONF_DIR="/home/ckruse/www/cforum/cgi-shared/config/"
/home/ckruse/www/cforum/cgi-bin/fo_server
\end{verbatim}

Danach sollte das Forum fast automatisch laufen, Sie sollten den Foren-Server nur alle paar Tage beenden, um die Logfiles
zu löschen oder zu verschieben und dann wieder starten, sonst werden die Dateien zu gross.

\section{Fehlersuche}

Zur Fehlersuche ist das Error-Log unabdingbar. Das Classic Forum ist eigentlich recht geschwätzig, so dass die Fehlersuche sich als
relativ einfach erweisen sollte. Bei auftretenden Fehlern sehen Sie zuerst in das Error-Log des Webservers. Wenn dort nichts hilfreiches
steht, schauen Sie ins Error-Log des Foren-Servers. Sollten Sie auch dort nicht fündig werden, gibt es die Möglichkeit die Foren-Programme
von der Shell aus zu starten:

\begin{verbatim}
export CF_CONF_DIR="/home/ckruse/www/cforum/cgi-shared/config/"
/home/ckruse/www/cforum/cgi-bin/fo_view
\end{verbatim}

Die eventuellen Fehler-Meldungen sind von da aus sofort einsehbar. Sollte der Fehler nur in der Thread-Ansicht auftreten, müssen
noch weitere Environment-Variablen gesetzt werden:

\begin{verbatim}
export QUERY_STRING="t=1&m=2"
export REQUEST_METHOD="GET"
export CF_CONF_DIR="/home/ckruse/www/cforum/cgi-shared/config/"
/home/ckruse/www/cforum/cgi-bin/fo_view
\end{verbatim}

Sollten die Probleme immer noch nicht lösbar sein, können Sie in das Entwickler-Forum posten. Sie finden es unter
der URL \texttt{http://wwwtech.de/cforum/forum/my/}.

\section{Shared Memory}
\label{shm}

Die Shared-Memory-Unterstützung des Forums ist etwas wie ein Nachbrenner. Sämtliche Thread-Daten werden in einem
Shared-Memory-Segment gespeichert, so dass bei einem einfachen lesenden Zugriff auf die Foren-Daten nicht mehr mit
dem Server kommuniziert werden muss, sondern direkt alles in den Speicher des Programms gemappt werden kann. Dadurch
wird ein enormer Performance-Vorteil erreicht. Jedoch hat dieses Verfahren auch Nachteile: wird ein neues Posting
eingereicht werden die Foren-Daten vollständig in ein zweites Speichersegment geschrieben. Danach wird eine
Semaphore (eine Art Integer-Variable im System) umgesetzt, so dass von nun an die Viewer-Programme auf das neue
Speichersegment zugreifen. Das kann bei vielen schreibenden Zugriffen (also vielen neuen Postings) dazu führen, dass
sich die Darstellung einer Nachricht unter Umständen um einige Sekunden verzögern kann, was beim Benutzer für Irritation
sorgen kann. Weiterhin muss unter Umständen etwas an der System-Konfiguration geändert werden, da die Größe der
Shared-Memory-Segmente stark von der Anzahl der Postings abhängt. Stellen Sie den Archiver so ein, dass sehr viele
Postings in der Hauptdatei enthalten werden können, werden die Speichersegmente unter Umständen auch sehr gross.
Viele Unix-artige Systeme beschränken die Größe der Segmente jedoch, so dass diese Grenze erhöht werden muss.
Unter Linux ist dies mit einem einfachen \texttt{sysctl}-Befehl möglich:

\begin{verbatim}
sysctl kernel.shmall 1342177280
sysctl kernel.shmmax 1342177280
\end{verbatim}

Die Werte können Sie nach beliebien anpassen. Die meisten Distributionen bieten eine Datei wie \texttt{/etc/sysctl.conf}
an, in der Sie diese Variablen fest eintragen können. Unter FreeBSD ist jedoch etwas mehr Arbeit, da muss ein neuer
Kernel kompiliert werden mit folgenden Optionen:

\begin{verbatim}
options SYSVSHM
options SYSVSEM
options SHMMAXPGS=4096
\end{verbatim}

Die maximale Größe der Segmente wird durch \texttt{SHMMAXPGS} in Seiten angegeben. Sie sehen also, dass die Nutzung von
Shared Memory ein zweischneidiges Schwert sein kann.

\section{Konfigurations-Dateien}

\subsection{Konfigurationsdatei \texttt{fo\_default.conf}}
Diese Konfigurationsdatei ist die Haupt-Konfigurationsdatei des Classic Forums. Sie wird von allem
Programmen und Scripten geparsed und ausgewertet. Sie enthält lediglich globale
Konfigurations-Daten, die für alle Scripte notwendig sind.


\subsection{Konfigurations-Datei \texttt{fo\_server.conf}}

Diese Konfigurations-Datei konfiguriert den Forums-Server. In ihr sind rein Server-spezifische
Einstellungen aufgehoben.

\subsection{Konfigurationsdatei \texttt{fo\_arcview.conf}}
Diese Konfigurations-Datei konfiguriert den Forums-Archivviewer. Im wesentlichen sind das Angaben
von Templates und ansonsten nicht viel mehr.

\subsection{Konfigurationsdatei fo\_post.conf}

\subsection{Konfigurationsdatei \texttt{fo\_userconf.conf}}

\subsection{Konfigurationsdatei \texttt{fo\_view.conf}}

\subsection{Konfigurationsdatei \texttt{fo\_xmlrpc.conf}}

\subsection{Konfigurationsdatei \texttt{fo\_default.conf}}

\subsection{Konfigurationsdatei \texttt{fo\_server.conf}}

\subsection{Konfigurationsdatei \texttt{fo\_usermanagement.conf}}

\subsection{Konfigurationsdatei \texttt{fo\_vote.conf}}

\end{document}

